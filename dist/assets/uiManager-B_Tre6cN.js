const b={mainContainer:document.getElementById("main-container"),startScreen:document.getElementById("start-screen"),gameScreen:document.getElementById("game-screen"),endScreen:document.getElementById("end-screen"),startButton:document.getElementById("start-button"),restartButton:document.getElementById("restart-button"),scoreEl:document.getElementById("score"),streakCounter:document.getElementById("streak-counter"),cardCounterEl:document.getElementById("card-counter"),nextCardContainer:document.getElementById("next-card-container"),timeline:document.getElementById("timeline"),timelineWrapper:document.getElementById("timeline-wrapper"),finalScoreEl:document.getElementById("final-score"),correctAnswersEl:document.getElementById("correct-answers"),wrongAnswersEl:document.getElementById("wrong-answers"),resumeModal:document.getElementById("resume-modal"),resumeYesButton:document.getElementById("resume-yes-button"),resumeNoButton:document.getElementById("resume-no-button"),resultsModal:document.getElementById("results-modal"),finalScoreModalEl:document.getElementById("final-score-modal"),correctAnswersModalEl:document.getElementById("correct-answers-modal"),wrongAnswersModalEl:document.getElementById("wrong-answers-modal"),closeResultsModalButton:document.getElementById("close-results-modal"),playAgainButton:document.getElementById("play-again-button")};var xt={};(function t(e,n,r,o){var i=!!(e.Worker&&e.Blob&&e.Promise&&e.OffscreenCanvas&&e.OffscreenCanvasRenderingContext2D&&e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.transferControlToOffscreen&&e.URL&&e.URL.createObjectURL),l=typeof Path2D=="function"&&typeof DOMMatrix=="function",c=(function(){if(!e.OffscreenCanvas)return!1;var s=new OffscreenCanvas(1,1),a=s.getContext("2d");a.fillRect(0,0,1,1);var p=s.transferToImageBitmap();try{a.createPattern(p,"no-repeat")}catch{return!1}return!0})();function d(){}function u(s){var a=n.exports.Promise,p=a!==void 0?a:e.Promise;return typeof p=="function"?new p(s):(s(d,d),null)}var m=(function(s,a){return{transform:function(p){if(s)return p;if(a.has(p))return a.get(p);var w=new OffscreenCanvas(p.width,p.height),C=w.getContext("2d");return C.drawImage(p,0,0),a.set(p,w),w},clear:function(){a.clear()}}})(c,new Map),h=(function(){var s=Math.floor(16.666666666666668),a,p,w={},C=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(a=function(S){var _=Math.random();return w[_]=requestAnimationFrame(function y(M){C===M||C+s-1<M?(C=M,delete w[_],S()):w[_]=requestAnimationFrame(y)}),_},p=function(S){w[S]&&cancelAnimationFrame(w[S])}):(a=function(S){return setTimeout(S,s)},p=function(S){return clearTimeout(S)}),{frame:a,cancel:p}})(),D=(function(){var s,a,p={};function w(C){function S(_,y){C.postMessage({options:_||{},callback:y})}C.init=function(y){var M=y.transferControlToOffscreen();C.postMessage({canvas:M},[M])},C.fire=function(y,M,B){if(a)return S(y,null),a;var R=Math.random().toString(36).slice(2);return a=u(function(L){function H(G){G.data.callback===R&&(delete p[R],C.removeEventListener("message",H),a=null,m.clear(),B(),L())}C.addEventListener("message",H),S(y,R),p[R]=H.bind(null,{data:{callback:R}})}),a},C.reset=function(){C.postMessage({reset:!0});for(var y in p)p[y](),delete p[y]}}return function(){if(s)return s;if(!r&&i){var C=["var CONFETTI, SIZE = {}, module = {};","("+t.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{s=new Worker(URL.createObjectURL(new Blob([C])))}catch(S){return typeof console!==void 0&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",S),null}w(s)}return s}})(),N={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function I(s,a){return a?a(s):s}function P(s){return s!=null}function A(s,a,p){return I(s&&P(s[a])?s[a]:N[a],p)}function oe(s){return s<0?0:Math.floor(s)}function j(s,a){return Math.floor(Math.random()*(a-s))+s}function U(s){return parseInt(s,16)}function q(s){return s.map(ge)}function ge(s){var a=String(s).replace(/[^0-9a-f]/gi,"");return a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),{r:U(a.substring(0,2)),g:U(a.substring(2,4)),b:U(a.substring(4,6))}}function ne(s){var a=A(s,"origin",Object);return a.x=A(a,"x",Number),a.y=A(a,"y",Number),a}function ve(s){s.width=document.documentElement.clientWidth,s.height=document.documentElement.clientHeight}function Me(s){var a=s.getBoundingClientRect();s.width=a.width,s.height=a.height}function V(s){var a=document.createElement("canvas");return a.style.position="fixed",a.style.top="0px",a.style.left="0px",a.style.pointerEvents="none",a.style.zIndex=s,a}function Te(s,a,p,w,C,S,_,y,M){s.save(),s.translate(a,p),s.rotate(S),s.scale(w,C),s.arc(0,0,1,_,y,M),s.restore()}function ue(s){var a=s.angle*(Math.PI/180),p=s.spread*(Math.PI/180);return{x:s.x,y:s.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:s.startVelocity*.5+Math.random()*s.startVelocity,angle2D:-a+(.5*p-Math.random()*p),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:s.color,shape:s.shape,tick:0,totalTicks:s.ticks,decay:s.decay,drift:s.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:s.gravity*3,ovalScalar:.6,scalar:s.scalar,flat:s.flat}}function Ie(s,a){a.x+=Math.cos(a.angle2D)*a.velocity+a.drift,a.y+=Math.sin(a.angle2D)*a.velocity+a.gravity,a.velocity*=a.decay,a.flat?(a.wobble=0,a.wobbleX=a.x+10*a.scalar,a.wobbleY=a.y+10*a.scalar,a.tiltSin=0,a.tiltCos=0,a.random=1):(a.wobble+=a.wobbleSpeed,a.wobbleX=a.x+10*a.scalar*Math.cos(a.wobble),a.wobbleY=a.y+10*a.scalar*Math.sin(a.wobble),a.tiltAngle+=.1,a.tiltSin=Math.sin(a.tiltAngle),a.tiltCos=Math.cos(a.tiltAngle),a.random=Math.random()+2);var p=a.tick++/a.totalTicks,w=a.x+a.random*a.tiltCos,C=a.y+a.random*a.tiltSin,S=a.wobbleX+a.random*a.tiltCos,_=a.wobbleY+a.random*a.tiltSin;if(s.fillStyle="rgba("+a.color.r+", "+a.color.g+", "+a.color.b+", "+(1-p)+")",s.beginPath(),l&&a.shape.type==="path"&&typeof a.shape.path=="string"&&Array.isArray(a.shape.matrix))s.fill(Be(a.shape.path,a.shape.matrix,a.x,a.y,Math.abs(S-w)*.1,Math.abs(_-C)*.1,Math.PI/10*a.wobble));else if(a.shape.type==="bitmap"){var y=Math.PI/10*a.wobble,M=Math.abs(S-w)*.1,B=Math.abs(_-C)*.1,R=a.shape.bitmap.width*a.scalar,L=a.shape.bitmap.height*a.scalar,H=new DOMMatrix([Math.cos(y)*M,Math.sin(y)*M,-Math.sin(y)*B,Math.cos(y)*B,a.x,a.y]);H.multiplySelf(new DOMMatrix(a.shape.matrix));var G=s.createPattern(m.transform(a.shape.bitmap),"no-repeat");G.setTransform(H),s.globalAlpha=1-p,s.fillStyle=G,s.fillRect(a.x-R/2,a.y-L/2,R,L),s.globalAlpha=1}else if(a.shape==="circle")s.ellipse?s.ellipse(a.x,a.y,Math.abs(S-w)*a.ovalScalar,Math.abs(_-C)*a.ovalScalar,Math.PI/10*a.wobble,0,2*Math.PI):Te(s,a.x,a.y,Math.abs(S-w)*a.ovalScalar,Math.abs(_-C)*a.ovalScalar,Math.PI/10*a.wobble,0,2*Math.PI);else if(a.shape==="star")for(var O=Math.PI/2*3,K=4*a.scalar,le=8*a.scalar,se=a.x,ye=a.y,Oe=5,he=Math.PI/Oe;Oe--;)se=a.x+Math.cos(O)*le,ye=a.y+Math.sin(O)*le,s.lineTo(se,ye),O+=he,se=a.x+Math.cos(O)*K,ye=a.y+Math.sin(O)*K,s.lineTo(se,ye),O+=he;else s.moveTo(Math.floor(a.x),Math.floor(a.y)),s.lineTo(Math.floor(a.wobbleX),Math.floor(C)),s.lineTo(Math.floor(S),Math.floor(_)),s.lineTo(Math.floor(w),Math.floor(a.wobbleY));return s.closePath(),s.fill(),a.tick<a.totalTicks}function ae(s,a,p,w,C){var S=a.slice(),_=s.getContext("2d"),y,M,B=u(function(R){function L(){y=M=null,_.clearRect(0,0,w.width,w.height),m.clear(),C(),R()}function H(){r&&!(w.width===o.width&&w.height===o.height)&&(w.width=s.width=o.width,w.height=s.height=o.height),!w.width&&!w.height&&(p(s),w.width=s.width,w.height=s.height),_.clearRect(0,0,w.width,w.height),S=S.filter(function(G){return Ie(_,G)}),S.length?y=h.frame(H):L()}y=h.frame(H),M=L});return{addFettis:function(R){return S=S.concat(R),B},canvas:s,promise:B,reset:function(){y&&h.cancel(y),M&&M()}}}function fe(s,a){var p=!s,w=!!A(a||{},"resize"),C=!1,S=A(a,"disableForReducedMotion",Boolean),_=i&&!!A(a||{},"useWorker"),y=_?D():null,M=p?ve:Me,B=s&&y?!!s.__confetti_initialized:!1,R=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,L;function H(O,K,le){for(var se=A(O,"particleCount",oe),ye=A(O,"angle",Number),Oe=A(O,"spread",Number),he=A(O,"startVelocity",Number),dn=A(O,"decay",Number),un=A(O,"gravity",Number),fn=A(O,"drift",Number),Bt=A(O,"colors",q),hn=A(O,"ticks",Number),Lt=A(O,"shapes"),mn=A(O,"scalar"),pn=!!A(O,"flat"),Ft=ne(O),kt=se,mt=[],gn=s.width*Ft.x,vn=s.height*Ft.y;kt--;)mt.push(ue({x:gn,y:vn,angle:ye,spread:Oe,startVelocity:he,color:Bt[kt%Bt.length],shape:Lt[j(0,Lt.length)],ticks:hn,decay:dn,gravity:un,drift:fn,scalar:mn,flat:pn}));return L?L.addFettis(mt):(L=ae(s,mt,M,K,le),L.promise)}function G(O){var K=S||A(O,"disableForReducedMotion",Boolean),le=A(O,"zIndex",Number);if(K&&R)return u(function(he){he()});p&&L?s=L.canvas:p&&!s&&(s=V(le),document.body.appendChild(s)),w&&!B&&M(s);var se={width:s.width,height:s.height};y&&!B&&y.init(s),B=!0,y&&(s.__confetti_initialized=!0);function ye(){if(y){var he={getBoundingClientRect:function(){if(!p)return s.getBoundingClientRect()}};M(he),y.postMessage({resize:{width:he.width,height:he.height}});return}se.width=se.height=null}function Oe(){L=null,w&&(C=!1,e.removeEventListener("resize",ye)),p&&s&&(document.body.contains(s)&&document.body.removeChild(s),s=null,B=!1)}return w&&!C&&(C=!0,e.addEventListener("resize",ye,!1)),y?y.fire(O,se,Oe):H(O,se,Oe)}return G.reset=function(){y&&y.reset(),L&&L.reset()},G}var be;function ie(){return be||(be=fe(null,{useWorker:!0,resize:!0})),be}function Be(s,a,p,w,C,S,_){var y=new Path2D(s),M=new Path2D;M.addPath(y,new DOMMatrix(a));var B=new Path2D;return B.addPath(M,new DOMMatrix([Math.cos(_)*C,Math.sin(_)*C,-Math.sin(_)*S,Math.cos(_)*S,p,w])),B}function xe(s){if(!l)throw new Error("path confetti are not supported in this browser");var a,p;typeof s=="string"?a=s:(a=s.path,p=s.matrix);var w=new Path2D(a),C=document.createElement("canvas"),S=C.getContext("2d");if(!p){for(var _=1e3,y=_,M=_,B=0,R=0,L,H,G=0;G<_;G+=2)for(var O=0;O<_;O+=2)S.isPointInPath(w,G,O,"nonzero")&&(y=Math.min(y,G),M=Math.min(M,O),B=Math.max(B,G),R=Math.max(R,O));L=B-y,H=R-M;var K=10,le=Math.min(K/L,K/H);p=[le,0,0,le,-Math.round(L/2+y)*le,-Math.round(H/2+M)*le]}return{type:"path",path:a,matrix:p}}function ht(s){var a,p=1,w="#000000",C='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof s=="string"?a=s:(a=s.text,p="scalar"in s?s.scalar:p,C="fontFamily"in s?s.fontFamily:C,w="color"in s?s.color:w);var S=10*p,_=""+S+"px "+C,y=new OffscreenCanvas(S,S),M=y.getContext("2d");M.font=_;var B=M.measureText(a),R=Math.ceil(B.actualBoundingBoxRight+B.actualBoundingBoxLeft),L=Math.ceil(B.actualBoundingBoxAscent+B.actualBoundingBoxDescent),H=2,G=B.actualBoundingBoxLeft+H,O=B.actualBoundingBoxAscent+H;R+=H+H,L+=H+H,y=new OffscreenCanvas(R,L),M=y.getContext("2d"),M.font=_,M.fillStyle=w,M.fillText(a,G,O);var K=1/p;return{type:"bitmap",bitmap:y.transferToImageBitmap(),matrix:[K,0,0,K,-R*K/2,-L*K/2]}}n.exports=function(){return ie().apply(this,arguments)},n.exports.reset=function(){ie().reset()},n.exports.create=fe,n.exports.shapeFromPath=xe,n.exports.shapeFromText=ht})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),xt,!1);const bn=xt.exports;xt.exports.create;let Ke={};const Rt=(t,e=!1)=>{const n=document.createElement("div");n.dataset.id=t.id,n.dataset.year=t.year,n.className="card bg-white p-4 rounded-lg border border-gray-200 w-full max-w-lg mx-auto relative select-none",e&&n.classList.add("shadow-lg"),e&&n.classList.add("cursor-move");const r=t.image?`<img src="${t.image}" alt="${t.title}" class="w-20 h-20 object-cover rounded flex-shrink-0">`:"";return n.innerHTML=`
    <div class="card-content flex items-center gap-4">
      ${r}
      <div class="text-wrapper flex-grow">
        <h3 class="font-bold text-lg text-gray-900">${t.title}</h3>
        <p class="text-gray-700 text-sm">${t.description}</p>
      </div>
      <div class="year-badge hidden absolute bg-gray-200 text-xs font-bold px-2 py-1 rounded text-gray-800">${t.isApproximate?"Circa":""} ${t.year}</div>
    </div>
  `,n},yn=()=>{if(b.timeline.classList.contains("very-dense-view"))return;const t=b.timelineWrapper.clientHeight;b.timeline.scrollHeight>t&&b.timeline.classList.add("very-dense-view")},wn=t=>{if(t<2)return;const e=document.createElement("div");e.className="streak-popup",e.textContent=`Â¡Racha x${t}!`,b.timeline.parentNode.appendChild(e),setTimeout(()=>{e.remove()},1500)},En=t=>{if(Ke.score!==t.score&&(b.scoreEl.textContent=t.score,b.scoreEl.classList.add("animate-jump"),setTimeout(()=>b.scoreEl.classList.remove("animate-jump"),300)),t.gameEvents.length>0){const o=t.timelineEvents.length;b.cardCounterEl.textContent=`${o}/${t.gameEvents.length}`}Ke.streak!==t.streak&&(t.streak>1?(b.streakCounter.classList.remove("hidden"),b.streakCounter.textContent=`ðŸ”¥ Racha x${t.streak}`,b.streakCounter.classList.add("animate-flash"),setTimeout(()=>b.streakCounter.classList.remove("animate-flash"),500),t.streak>Ke.streak&&wn(t.streak)):b.streakCounter.classList.add("hidden"));const e=[...t.timelineEvents].sort((o,i)=>o.year-i.year),n=new Map(Array.from(b.timeline.children).map(o=>[o.dataset.id,o])),r=new Set;if(e.forEach(o=>{const i=String(o.id);r.add(i);let l=n.get(i);l||(l=Rt(o),l.classList.add("card-entering"),setTimeout(()=>{l.classList.remove("card-entering")},400)),l.classList.add("card-in-timeline"),l.classList.remove("shadow-lg"),o.isResolved&&(l.querySelector(".year-badge").classList.remove("hidden"),l.classList.toggle("correct",!o.isAnchor&&o.isCorrect),l.classList.toggle("incorrect",!o.isAnchor&&!o.isCorrect),l.classList.toggle("anchor-card",o.isAnchor)),l.classList.toggle("is-expanded",o.isExpanded),b.timeline.appendChild(l)}),n.forEach((o,i)=>{r.has(i)||o.remove()}),yn(),b.nextCardContainer.innerHTML="",t.nextCard){const o=Rt(t.nextCard,!0);b.nextCardContainer.appendChild(o)}else t.isGameOver||(b.nextCardContainer.innerHTML='<div class="text-center text-gray-500">Â¡No hay mÃ¡s cartas!</div>');t.isGameOver?(b.gameScreen.classList.add("hidden"),b.resultsModal.classList.remove("hidden"),bn({particleCount:100,spread:70,origin:{y:.6}}),b.finalScoreModalEl.textContent=t.score,b.correctAnswersModalEl.textContent=t.correctAnswers,b.wrongAnswersModalEl.textContent=t.wrongAnswers):t.timelineEvents.length>0?(b.startScreen.classList.add("hidden"),b.gameScreen.classList.remove("hidden")):(b.startScreen.classList.remove("hidden"),b.gameScreen.classList.add("hidden")),Ke={...t}};/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Ht(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function pe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ht(Object(n),!0).forEach(function(r){Cn(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ht(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function nt(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?nt=function(e){return typeof e}:nt=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nt(t)}function Cn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ee(){return Ee=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Ee.apply(this,arguments)}function Sn(t,e){if(t==null)return{};var n={},r=Object.keys(t),o,i;for(i=0;i<r.length;i++)o=r[i],!(e.indexOf(o)>=0)&&(n[o]=t[o]);return n}function Dn(t,e){if(t==null)return{};var n=Sn(t,e),r,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(o=0;o<i.length;o++)r=i[o],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}var _n="1.15.6";function we(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}var Ce=we(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Ve=we(/Edge/i),Yt=we(/firefox/i),Ge=we(/safari/i)&&!we(/chrome/i)&&!we(/android/i),Ot=we(/iP(ad|od|hone)/i),qt=we(/chrome/i)&&we(/android/i),Vt={capture:!1,passive:!1};function x(t,e,n){t.addEventListener(e,n,!Ce&&Vt)}function T(t,e,n){t.removeEventListener(e,n,!Ce&&Vt)}function lt(t,e){if(e){if(e[0]===">"&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch{return!1}return!1}}function Zt(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function de(t,e,n,r){if(t){n=n||document;do{if(e!=null&&(e[0]===">"?t.parentNode===n&&lt(t,e):lt(t,e))||r&&t===n)return t;if(t===n)break}while(t=Zt(t))}return null}var Wt=/\s+/g;function ee(t,e,n){if(t&&e)if(t.classList)t.classList[n?"add":"remove"](e);else{var r=(" "+t.className+" ").replace(Wt," ").replace(" "+e+" "," ");t.className=(r+(n?" "+e:"")).replace(Wt," ")}}function v(t,e,n){var r=t&&t.style;if(r){if(n===void 0)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),e===void 0?n:n[e];!(e in r)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),r[e]=n+(typeof n=="string"?"":"px")}}function He(t,e){var n="";if(typeof t=="string")n=t;else do{var r=v(t,"transform");r&&r!=="none"&&(n=r+" "+n)}while(!e&&(t=t.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(n)}function Kt(t,e,n){if(t){var r=t.getElementsByTagName(e),o=0,i=r.length;if(n)for(;o<i;o++)n(r[o],o);return r}return[]}function me(){var t=document.scrollingElement;return t||document.documentElement}function X(t,e,n,r,o){if(!(!t.getBoundingClientRect&&t!==window)){var i,l,c,d,u,m,h;if(t!==window&&t.parentNode&&t!==me()?(i=t.getBoundingClientRect(),l=i.top,c=i.left,d=i.bottom,u=i.right,m=i.height,h=i.width):(l=0,c=0,d=window.innerHeight,u=window.innerWidth,m=window.innerHeight,h=window.innerWidth),(e||n)&&t!==window&&(o=o||t.parentNode,!Ce))do if(o&&o.getBoundingClientRect&&(v(o,"transform")!=="none"||n&&v(o,"position")!=="static")){var D=o.getBoundingClientRect();l-=D.top+parseInt(v(o,"border-top-width")),c-=D.left+parseInt(v(o,"border-left-width")),d=l+i.height,u=c+i.width;break}while(o=o.parentNode);if(r&&t!==window){var N=He(o||t),I=N&&N.a,P=N&&N.d;N&&(l/=P,c/=I,h/=I,m/=P,d=l+m,u=c+h)}return{top:l,left:c,bottom:d,right:u,width:h,height:m}}}function Xt(t,e,n){for(var r=_e(t,!0),o=X(t)[e];r;){var i=X(r)[n],l=void 0;if(l=o>=i,!l)return r;if(r===me())break;r=_e(r,!1)}return!1}function Ye(t,e,n,r){for(var o=0,i=0,l=t.children;i<l.length;){if(l[i].style.display!=="none"&&l[i]!==g.ghost&&(r||l[i]!==g.dragged)&&de(l[i],n.draggable,t,!1)){if(o===e)return l[i];o++}i++}return null}function At(t,e){for(var n=t.lastElementChild;n&&(n===g.ghost||v(n,"display")==="none"||e&&!lt(n,e));)n=n.previousElementSibling;return n||null}function re(t,e){var n=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==g.clone&&(!e||lt(t,e))&&n++;return n}function jt(t){var e=0,n=0,r=me();if(t)do{var o=He(t),i=o.a,l=o.d;e+=t.scrollLeft*i,n+=t.scrollTop*l}while(t!==r&&(t=t.parentNode));return[e,n]}function Mn(t,e){for(var n in t)if(t.hasOwnProperty(n)){for(var r in e)if(e.hasOwnProperty(r)&&e[r]===t[n][r])return Number(n)}return-1}function _e(t,e){if(!t||!t.getBoundingClientRect)return me();var n=t,r=!1;do if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var o=v(n);if(n.clientWidth<n.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||n.clientHeight<n.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!n.getBoundingClientRect||n===document.body)return me();if(r||e)return n;r=!0}}while(n=n.parentNode);return me()}function Tn(t,e){if(t&&e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function pt(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}var ze;function Qt(t,e){return function(){if(!ze){var n=arguments,r=this;n.length===1?t.call(r,n[0]):t.apply(r,n),ze=setTimeout(function(){ze=void 0},e)}}}function In(){clearTimeout(ze),ze=void 0}function Jt(t,e,n){t.scrollLeft+=e,t.scrollTop+=n}function en(t){var e=window.Polymer,n=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):n?n(t).clone(!0)[0]:t.cloneNode(!0)}function tn(t,e,n){var r={};return Array.from(t.children).forEach(function(o){var i,l,c,d;if(!(!de(o,e.draggable,t,!1)||o.animated||o===n)){var u=X(o);r.left=Math.min((i=r.left)!==null&&i!==void 0?i:1/0,u.left),r.top=Math.min((l=r.top)!==null&&l!==void 0?l:1/0,u.top),r.right=Math.max((c=r.right)!==null&&c!==void 0?c:-1/0,u.right),r.bottom=Math.max((d=r.bottom)!==null&&d!==void 0?d:-1/0,u.bottom)}}),r.width=r.right-r.left,r.height=r.bottom-r.top,r.x=r.left,r.y=r.top,r}var J="Sortable"+new Date().getTime();function xn(){var t=[],e;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var r=[].slice.call(this.el.children);r.forEach(function(o){if(!(v(o,"display")==="none"||o===g.ghost)){t.push({target:o,rect:X(o)});var i=pe({},t[t.length-1].rect);if(o.thisAnimationDuration){var l=He(o,!0);l&&(i.top-=l.f,i.left-=l.e)}o.fromRect=i}})}},addAnimationState:function(r){t.push(r)},removeAnimationState:function(r){t.splice(Mn(t,{target:r}),1)},animateAll:function(r){var o=this;if(!this.options.animation){clearTimeout(e),typeof r=="function"&&r();return}var i=!1,l=0;t.forEach(function(c){var d=0,u=c.target,m=u.fromRect,h=X(u),D=u.prevFromRect,N=u.prevToRect,I=c.rect,P=He(u,!0);P&&(h.top-=P.f,h.left-=P.e),u.toRect=h,u.thisAnimationDuration&&pt(D,h)&&!pt(m,h)&&(I.top-h.top)/(I.left-h.left)===(m.top-h.top)/(m.left-h.left)&&(d=An(I,D,N,o.options)),pt(h,m)||(u.prevFromRect=m,u.prevToRect=h,d||(d=o.options.animation),o.animate(u,I,h,d)),d&&(i=!0,l=Math.max(l,d),clearTimeout(u.animationResetTimer),u.animationResetTimer=setTimeout(function(){u.animationTime=0,u.prevFromRect=null,u.fromRect=null,u.prevToRect=null,u.thisAnimationDuration=null},d),u.thisAnimationDuration=d)}),clearTimeout(e),i?e=setTimeout(function(){typeof r=="function"&&r()},l):typeof r=="function"&&r(),t=[]},animate:function(r,o,i,l){if(l){v(r,"transition",""),v(r,"transform","");var c=He(this.el),d=c&&c.a,u=c&&c.d,m=(o.left-i.left)/(d||1),h=(o.top-i.top)/(u||1);r.animatingX=!!m,r.animatingY=!!h,v(r,"transform","translate3d("+m+"px,"+h+"px,0)"),this.forRepaintDummy=On(r),v(r,"transition","transform "+l+"ms"+(this.options.easing?" "+this.options.easing:"")),v(r,"transform","translate3d(0,0,0)"),typeof r.animated=="number"&&clearTimeout(r.animated),r.animated=setTimeout(function(){v(r,"transition",""),v(r,"transform",""),r.animated=!1,r.animatingX=!1,r.animatingY=!1},l)}}}}function On(t){return t.offsetWidth}function An(t,e,n,r){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))*r.animation}var Le=[],gt={initializeByDefault:!0},Ze={mount:function(e){for(var n in gt)gt.hasOwnProperty(n)&&!(n in e)&&(e[n]=gt[n]);Le.forEach(function(r){if(r.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),Le.push(e)},pluginEvent:function(e,n,r){var o=this;this.eventCanceled=!1,r.cancel=function(){o.eventCanceled=!0};var i=e+"Global";Le.forEach(function(l){n[l.pluginName]&&(n[l.pluginName][i]&&n[l.pluginName][i](pe({sortable:n},r)),n.options[l.pluginName]&&n[l.pluginName][e]&&n[l.pluginName][e](pe({sortable:n},r)))})},initializePlugins:function(e,n,r,o){Le.forEach(function(c){var d=c.pluginName;if(!(!e.options[d]&&!c.initializeByDefault)){var u=new c(e,n,e.options);u.sortable=e,u.options=e.options,e[d]=u,Ee(r,u.defaults)}});for(var i in e.options)if(e.options.hasOwnProperty(i)){var l=this.modifyOption(e,i,e.options[i]);typeof l<"u"&&(e.options[i]=l)}},getEventProperties:function(e,n){var r={};return Le.forEach(function(o){typeof o.eventProperties=="function"&&Ee(r,o.eventProperties.call(n[o.pluginName],e))}),r},modifyOption:function(e,n,r){var o;return Le.forEach(function(i){e[i.pluginName]&&i.optionListeners&&typeof i.optionListeners[n]=="function"&&(o=i.optionListeners[n].call(e[i.pluginName],r))}),o}};function Pn(t){var e=t.sortable,n=t.rootEl,r=t.name,o=t.targetEl,i=t.cloneEl,l=t.toEl,c=t.fromEl,d=t.oldIndex,u=t.newIndex,m=t.oldDraggableIndex,h=t.newDraggableIndex,D=t.originalEvent,N=t.putSortable,I=t.extraEventProperties;if(e=e||n&&n[J],!!e){var P,A=e.options,oe="on"+r.charAt(0).toUpperCase()+r.substr(1);window.CustomEvent&&!Ce&&!Ve?P=new CustomEvent(r,{bubbles:!0,cancelable:!0}):(P=document.createEvent("Event"),P.initEvent(r,!0,!0)),P.to=l||n,P.from=c||n,P.item=o||n,P.clone=i,P.oldIndex=d,P.newIndex=u,P.oldDraggableIndex=m,P.newDraggableIndex=h,P.originalEvent=D,P.pullMode=N?N.lastPutMode:void 0;var j=pe(pe({},I),Ze.getEventProperties(r,e));for(var U in j)P[U]=j[U];n&&n.dispatchEvent(P),A[oe]&&A[oe].call(e,P)}}var Nn=["evt"],Q=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=r.evt,i=Dn(r,Nn);Ze.pluginEvent.bind(g)(e,n,pe({dragEl:f,parentEl:Y,ghostEl:E,rootEl:F,nextEl:Ne,lastDownEl:rt,cloneEl:k,cloneHidden:De,dragStarted:We,putSortable:z,activeSortable:g.active,originalEvent:o,oldIndex:Re,oldDraggableIndex:$e,newIndex:te,newDraggableIndex:Se,hideGhostForTarget:an,unhideGhostForTarget:ln,cloneNowHidden:function(){De=!0},cloneNowShown:function(){De=!1},dispatchSortableEvent:function(c){Z({sortable:n,name:c,originalEvent:o})}},i))};function Z(t){Pn(pe({putSortable:z,cloneEl:k,targetEl:f,rootEl:F,oldIndex:Re,oldDraggableIndex:$e,newIndex:te,newDraggableIndex:Se},t))}var f,Y,E,F,Ne,rt,k,De,Re,te,$e,Se,Qe,z,ke=!1,st=!1,ct=[],Ae,ce,vt,bt,Gt,zt,We,Fe,Ue,qe=!1,Je=!1,ot,$,yt=[],Dt=!1,dt=[],ft=typeof document<"u",et=Ot,$t=Ve||Ce?"cssFloat":"float",Bn=ft&&!qt&&!Ot&&"draggable"in document.createElement("div"),nn=(function(){if(ft){if(Ce)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}})(),rn=function(e,n){var r=v(e),o=parseInt(r.width)-parseInt(r.paddingLeft)-parseInt(r.paddingRight)-parseInt(r.borderLeftWidth)-parseInt(r.borderRightWidth),i=Ye(e,0,n),l=Ye(e,1,n),c=i&&v(i),d=l&&v(l),u=c&&parseInt(c.marginLeft)+parseInt(c.marginRight)+X(i).width,m=d&&parseInt(d.marginLeft)+parseInt(d.marginRight)+X(l).width;if(r.display==="flex")return r.flexDirection==="column"||r.flexDirection==="column-reverse"?"vertical":"horizontal";if(r.display==="grid")return r.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(i&&c.float&&c.float!=="none"){var h=c.float==="left"?"left":"right";return l&&(d.clear==="both"||d.clear===h)?"vertical":"horizontal"}return i&&(c.display==="block"||c.display==="flex"||c.display==="table"||c.display==="grid"||u>=o&&r[$t]==="none"||l&&r[$t]==="none"&&u+m>o)?"vertical":"horizontal"},Ln=function(e,n,r){var o=r?e.left:e.top,i=r?e.right:e.bottom,l=r?e.width:e.height,c=r?n.left:n.top,d=r?n.right:n.bottom,u=r?n.width:n.height;return o===c||i===d||o+l/2===c+u/2},Fn=function(e,n){var r;return ct.some(function(o){var i=o[J].options.emptyInsertThreshold;if(!(!i||At(o))){var l=X(o),c=e>=l.left-i&&e<=l.right+i,d=n>=l.top-i&&n<=l.bottom+i;if(c&&d)return r=o}}),r},on=function(e){function n(i,l){return function(c,d,u,m){var h=c.options.group.name&&d.options.group.name&&c.options.group.name===d.options.group.name;if(i==null&&(l||h))return!0;if(i==null||i===!1)return!1;if(l&&i==="clone")return i;if(typeof i=="function")return n(i(c,d,u,m),l)(c,d,u,m);var D=(l?c:d).options.group.name;return i===!0||typeof i=="string"&&i===D||i.join&&i.indexOf(D)>-1}}var r={},o=e.group;(!o||nt(o)!="object")&&(o={name:o}),r.name=o.name,r.checkPull=n(o.pull,!0),r.checkPut=n(o.put),r.revertClone=o.revertClone,e.group=r},an=function(){!nn&&E&&v(E,"display","none")},ln=function(){!nn&&E&&v(E,"display","")};ft&&!qt&&document.addEventListener("click",function(t){if(st)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),st=!1,!1},!0);var Pe=function(e){if(f){e=e.touches?e.touches[0]:e;var n=Fn(e.clientX,e.clientY);if(n){var r={};for(var o in e)e.hasOwnProperty(o)&&(r[o]=e[o]);r.target=r.rootEl=n,r.preventDefault=void 0,r.stopPropagation=void 0,n[J]._onDragOver(r)}}},kn=function(e){f&&f.parentNode[J]._isOutsideThisEl(e.target)};function g(t,e){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=Ee({},e),t[J]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return rn(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(l,c){l.setData("Text",c.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:g.supportPointer!==!1&&"PointerEvent"in window&&(!Ge||Ot),emptyInsertThreshold:5};Ze.initializePlugins(this,t,n);for(var r in n)!(r in e)&&(e[r]=n[r]);on(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:Bn,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?x(t,"pointerdown",this._onTapStart):(x(t,"mousedown",this._onTapStart),x(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(x(t,"dragover",this),x(t,"dragenter",this)),ct.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Ee(this,xn())}g.prototype={constructor:g,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(Fe=null)},_getDirection:function(e,n){return typeof this.options.direction=="function"?this.options.direction.call(this,e,n,f):this.options.direction},_onTapStart:function(e){if(e.cancelable){var n=this,r=this.el,o=this.options,i=o.preventOnFilter,l=e.type,c=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,d=(c||e).target,u=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||d,m=o.filter;if(zn(r),!f&&!(/mousedown|pointerdown/.test(l)&&e.button!==0||o.disabled)&&!u.isContentEditable&&!(!this.nativeDraggable&&Ge&&d&&d.tagName.toUpperCase()==="SELECT")&&(d=de(d,o.draggable,r,!1),!(d&&d.animated)&&rt!==d)){if(Re=re(d),$e=re(d,o.draggable),typeof m=="function"){if(m.call(this,e,d,this)){Z({sortable:n,rootEl:u,name:"filter",targetEl:d,toEl:r,fromEl:r}),Q("filter",n,{evt:e}),i&&e.preventDefault();return}}else if(m&&(m=m.split(",").some(function(h){if(h=de(u,h.trim(),r,!1),h)return Z({sortable:n,rootEl:h,name:"filter",targetEl:d,fromEl:r,toEl:r}),Q("filter",n,{evt:e}),!0}),m)){i&&e.preventDefault();return}o.handle&&!de(u,o.handle,r,!1)||this._prepareDragStart(e,c,d)}}},_prepareDragStart:function(e,n,r){var o=this,i=o.el,l=o.options,c=i.ownerDocument,d;if(r&&!f&&r.parentNode===i){var u=X(r);if(F=i,f=r,Y=f.parentNode,Ne=f.nextSibling,rt=r,Qe=l.group,g.dragged=f,Ae={target:f,clientX:(n||e).clientX,clientY:(n||e).clientY},Gt=Ae.clientX-u.left,zt=Ae.clientY-u.top,this._lastX=(n||e).clientX,this._lastY=(n||e).clientY,f.style["will-change"]="all",d=function(){if(Q("delayEnded",o,{evt:e}),g.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!Yt&&o.nativeDraggable&&(f.draggable=!0),o._triggerDragStart(e,n),Z({sortable:o,name:"choose",originalEvent:e}),ee(f,l.chosenClass,!0)},l.ignore.split(",").forEach(function(m){Kt(f,m.trim(),wt)}),x(c,"dragover",Pe),x(c,"mousemove",Pe),x(c,"touchmove",Pe),l.supportPointer?(x(c,"pointerup",o._onDrop),!this.nativeDraggable&&x(c,"pointercancel",o._onDrop)):(x(c,"mouseup",o._onDrop),x(c,"touchend",o._onDrop),x(c,"touchcancel",o._onDrop)),Yt&&this.nativeDraggable&&(this.options.touchStartThreshold=4,f.draggable=!0),Q("delayStart",this,{evt:e}),l.delay&&(!l.delayOnTouchOnly||n)&&(!this.nativeDraggable||!(Ve||Ce))){if(g.eventCanceled){this._onDrop();return}l.supportPointer?(x(c,"pointerup",o._disableDelayedDrag),x(c,"pointercancel",o._disableDelayedDrag)):(x(c,"mouseup",o._disableDelayedDrag),x(c,"touchend",o._disableDelayedDrag),x(c,"touchcancel",o._disableDelayedDrag)),x(c,"mousemove",o._delayedDragTouchMoveHandler),x(c,"touchmove",o._delayedDragTouchMoveHandler),l.supportPointer&&x(c,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(d,l.delay)}else d()}},_delayedDragTouchMoveHandler:function(e){var n=e.touches?e.touches[0]:e;Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){f&&wt(f),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;T(e,"mouseup",this._disableDelayedDrag),T(e,"touchend",this._disableDelayedDrag),T(e,"touchcancel",this._disableDelayedDrag),T(e,"pointerup",this._disableDelayedDrag),T(e,"pointercancel",this._disableDelayedDrag),T(e,"mousemove",this._delayedDragTouchMoveHandler),T(e,"touchmove",this._delayedDragTouchMoveHandler),T(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,n){n=n||e.pointerType=="touch"&&e,!this.nativeDraggable||n?this.options.supportPointer?x(document,"pointermove",this._onTouchMove):n?x(document,"touchmove",this._onTouchMove):x(document,"mousemove",this._onTouchMove):(x(f,"dragend",this),x(F,"dragstart",this._onDragStart));try{document.selection?at(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,n){if(ke=!1,F&&f){Q("dragStarted",this,{evt:n}),this.nativeDraggable&&x(document,"dragover",kn);var r=this.options;!e&&ee(f,r.dragClass,!1),ee(f,r.ghostClass,!0),g.active=this,e&&this._appendGhost(),Z({sortable:this,name:"start",originalEvent:n})}else this._nulling()},_emulateDragOver:function(){if(ce){this._lastX=ce.clientX,this._lastY=ce.clientY,an();for(var e=document.elementFromPoint(ce.clientX,ce.clientY),n=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(ce.clientX,ce.clientY),e!==n);)n=e;if(f.parentNode[J]._isOutsideThisEl(e),n)do{if(n[J]){var r=void 0;if(r=n[J]._onDragOver({clientX:ce.clientX,clientY:ce.clientY,target:e,rootEl:n}),r&&!this.options.dragoverBubble)break}e=n}while(n=Zt(n));ln()}},_onTouchMove:function(e){if(Ae){var n=this.options,r=n.fallbackTolerance,o=n.fallbackOffset,i=e.touches?e.touches[0]:e,l=E&&He(E,!0),c=E&&l&&l.a,d=E&&l&&l.d,u=et&&$&&jt($),m=(i.clientX-Ae.clientX+o.x)/(c||1)+(u?u[0]-yt[0]:0)/(c||1),h=(i.clientY-Ae.clientY+o.y)/(d||1)+(u?u[1]-yt[1]:0)/(d||1);if(!g.active&&!ke){if(r&&Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))<r)return;this._onDragStart(e,!0)}if(E){l?(l.e+=m-(vt||0),l.f+=h-(bt||0)):l={a:1,b:0,c:0,d:1,e:m,f:h};var D="matrix(".concat(l.a,",").concat(l.b,",").concat(l.c,",").concat(l.d,",").concat(l.e,",").concat(l.f,")");v(E,"webkitTransform",D),v(E,"mozTransform",D),v(E,"msTransform",D),v(E,"transform",D),vt=m,bt=h,ce=i}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!E){var e=this.options.fallbackOnBody?document.body:F,n=X(f,!0,et,!0,e),r=this.options;if(et){for($=e;v($,"position")==="static"&&v($,"transform")==="none"&&$!==document;)$=$.parentNode;$!==document.body&&$!==document.documentElement?($===document&&($=me()),n.top+=$.scrollTop,n.left+=$.scrollLeft):$=me(),yt=jt($)}E=f.cloneNode(!0),ee(E,r.ghostClass,!1),ee(E,r.fallbackClass,!0),ee(E,r.dragClass,!0),v(E,"transition",""),v(E,"transform",""),v(E,"box-sizing","border-box"),v(E,"margin",0),v(E,"top",n.top),v(E,"left",n.left),v(E,"width",n.width),v(E,"height",n.height),v(E,"opacity","0.8"),v(E,"position",et?"absolute":"fixed"),v(E,"zIndex","100000"),v(E,"pointerEvents","none"),g.ghost=E,e.appendChild(E),v(E,"transform-origin",Gt/parseInt(E.style.width)*100+"% "+zt/parseInt(E.style.height)*100+"%")}},_onDragStart:function(e,n){var r=this,o=e.dataTransfer,i=r.options;if(Q("dragStart",this,{evt:e}),g.eventCanceled){this._onDrop();return}Q("setupClone",this),g.eventCanceled||(k=en(f),k.removeAttribute("id"),k.draggable=!1,k.style["will-change"]="",this._hideClone(),ee(k,this.options.chosenClass,!1),g.clone=k),r.cloneId=at(function(){Q("clone",r),!g.eventCanceled&&(r.options.removeCloneOnHide||F.insertBefore(k,f),r._hideClone(),Z({sortable:r,name:"clone"}))}),!n&&ee(f,i.dragClass,!0),n?(st=!0,r._loopId=setInterval(r._emulateDragOver,50)):(T(document,"mouseup",r._onDrop),T(document,"touchend",r._onDrop),T(document,"touchcancel",r._onDrop),o&&(o.effectAllowed="move",i.setData&&i.setData.call(r,o,f)),x(document,"drop",r),v(f,"transform","translateZ(0)")),ke=!0,r._dragStartId=at(r._dragStarted.bind(r,n,e)),x(document,"selectstart",r),We=!0,window.getSelection().removeAllRanges(),Ge&&v(document.body,"user-select","none")},_onDragOver:function(e){var n=this.el,r=e.target,o,i,l,c=this.options,d=c.group,u=g.active,m=Qe===d,h=c.sort,D=z||u,N,I=this,P=!1;if(Dt)return;function A(xe,ht){Q(xe,I,pe({evt:e,isOwner:m,axis:N?"vertical":"horizontal",revert:l,dragRect:o,targetRect:i,canSort:h,fromSortable:D,target:r,completed:j,onMove:function(a,p){return tt(F,n,f,o,a,X(a),e,p)},changed:U},ht))}function oe(){A("dragOverAnimationCapture"),I.captureAnimationState(),I!==D&&D.captureAnimationState()}function j(xe){return A("dragOverCompleted",{insertion:xe}),xe&&(m?u._hideClone():u._showClone(I),I!==D&&(ee(f,z?z.options.ghostClass:u.options.ghostClass,!1),ee(f,c.ghostClass,!0)),z!==I&&I!==g.active?z=I:I===g.active&&z&&(z=null),D===I&&(I._ignoreWhileAnimating=r),I.animateAll(function(){A("dragOverAnimationComplete"),I._ignoreWhileAnimating=null}),I!==D&&(D.animateAll(),D._ignoreWhileAnimating=null)),(r===f&&!f.animated||r===n&&!r.animated)&&(Fe=null),!c.dragoverBubble&&!e.rootEl&&r!==document&&(f.parentNode[J]._isOutsideThisEl(e.target),!xe&&Pe(e)),!c.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),P=!0}function U(){te=re(f),Se=re(f,c.draggable),Z({sortable:I,name:"change",toEl:n,newIndex:te,newDraggableIndex:Se,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),r=de(r,c.draggable,n,!0),A("dragOver"),g.eventCanceled)return P;if(f.contains(e.target)||r.animated&&r.animatingX&&r.animatingY||I._ignoreWhileAnimating===r)return j(!1);if(st=!1,u&&!c.disabled&&(m?h||(l=Y!==F):z===this||(this.lastPutMode=Qe.checkPull(this,u,f,e))&&d.checkPut(this,u,f,e))){if(N=this._getDirection(e,r)==="vertical",o=X(f),A("dragOverValid"),g.eventCanceled)return P;if(l)return Y=F,oe(),this._hideClone(),A("revert"),g.eventCanceled||(Ne?F.insertBefore(f,Ne):F.appendChild(f)),j(!0);var q=At(n,c.draggable);if(!q||Wn(e,N,this)&&!q.animated){if(q===f)return j(!1);if(q&&n===e.target&&(r=q),r&&(i=X(r)),tt(F,n,f,o,r,i,e,!!r)!==!1)return oe(),q&&q.nextSibling?n.insertBefore(f,q.nextSibling):n.appendChild(f),Y=n,U(),j(!0)}else if(q&&Yn(e,N,this)){var ge=Ye(n,0,c,!0);if(ge===f)return j(!1);if(r=ge,i=X(r),tt(F,n,f,o,r,i,e,!1)!==!1)return oe(),n.insertBefore(f,ge),Y=n,U(),j(!0)}else if(r.parentNode===n){i=X(r);var ne=0,ve,Me=f.parentNode!==n,V=!Ln(f.animated&&f.toRect||o,r.animated&&r.toRect||i,N),Te=N?"top":"left",ue=Xt(r,"top","top")||Xt(f,"top","top"),Ie=ue?ue.scrollTop:void 0;Fe!==r&&(ve=i[Te],qe=!1,Je=!V&&c.invertSwap||Me),ne=Xn(e,r,i,N,V?1:c.swapThreshold,c.invertedSwapThreshold==null?c.swapThreshold:c.invertedSwapThreshold,Je,Fe===r);var ae;if(ne!==0){var fe=re(f);do fe-=ne,ae=Y.children[fe];while(ae&&(v(ae,"display")==="none"||ae===E))}if(ne===0||ae===r)return j(!1);Fe=r,Ue=ne;var be=r.nextElementSibling,ie=!1;ie=ne===1;var Be=tt(F,n,f,o,r,i,e,ie);if(Be!==!1)return(Be===1||Be===-1)&&(ie=Be===1),Dt=!0,setTimeout(Hn,30),oe(),ie&&!be?n.appendChild(f):r.parentNode.insertBefore(f,ie?be:r),ue&&Jt(ue,0,Ie-ue.scrollTop),Y=f.parentNode,ve!==void 0&&!Je&&(ot=Math.abs(ve-X(r)[Te])),U(),j(!0)}if(n.contains(f))return j(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){T(document,"mousemove",this._onTouchMove),T(document,"touchmove",this._onTouchMove),T(document,"pointermove",this._onTouchMove),T(document,"dragover",Pe),T(document,"mousemove",Pe),T(document,"touchmove",Pe)},_offUpEvents:function(){var e=this.el.ownerDocument;T(e,"mouseup",this._onDrop),T(e,"touchend",this._onDrop),T(e,"pointerup",this._onDrop),T(e,"pointercancel",this._onDrop),T(e,"touchcancel",this._onDrop),T(document,"selectstart",this)},_onDrop:function(e){var n=this.el,r=this.options;if(te=re(f),Se=re(f,r.draggable),Q("drop",this,{evt:e}),Y=f&&f.parentNode,te=re(f),Se=re(f,r.draggable),g.eventCanceled){this._nulling();return}ke=!1,Je=!1,qe=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),_t(this.cloneId),_t(this._dragStartId),this.nativeDraggable&&(T(document,"drop",this),T(n,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Ge&&v(document.body,"user-select",""),v(f,"transform",""),e&&(We&&(e.cancelable&&e.preventDefault(),!r.dropBubble&&e.stopPropagation()),E&&E.parentNode&&E.parentNode.removeChild(E),(F===Y||z&&z.lastPutMode!=="clone")&&k&&k.parentNode&&k.parentNode.removeChild(k),f&&(this.nativeDraggable&&T(f,"dragend",this),wt(f),f.style["will-change"]="",We&&!ke&&ee(f,z?z.options.ghostClass:this.options.ghostClass,!1),ee(f,this.options.chosenClass,!1),Z({sortable:this,name:"unchoose",toEl:Y,newIndex:null,newDraggableIndex:null,originalEvent:e}),F!==Y?(te>=0&&(Z({rootEl:Y,name:"add",toEl:Y,fromEl:F,originalEvent:e}),Z({sortable:this,name:"remove",toEl:Y,originalEvent:e}),Z({rootEl:Y,name:"sort",toEl:Y,fromEl:F,originalEvent:e}),Z({sortable:this,name:"sort",toEl:Y,originalEvent:e})),z&&z.save()):te!==Re&&te>=0&&(Z({sortable:this,name:"update",toEl:Y,originalEvent:e}),Z({sortable:this,name:"sort",toEl:Y,originalEvent:e})),g.active&&((te==null||te===-1)&&(te=Re,Se=$e),Z({sortable:this,name:"end",toEl:Y,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){Q("nulling",this),F=f=Y=E=Ne=k=rt=De=Ae=ce=We=te=Se=Re=$e=Fe=Ue=z=Qe=g.dragged=g.ghost=g.clone=g.active=null,dt.forEach(function(e){e.checked=!0}),dt.length=vt=bt=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":f&&(this._onDragOver(e),Rn(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],n,r=this.el.children,o=0,i=r.length,l=this.options;o<i;o++)n=r[o],de(n,l.draggable,this.el,!1)&&e.push(n.getAttribute(l.dataIdAttr)||Gn(n));return e},sort:function(e,n){var r={},o=this.el;this.toArray().forEach(function(i,l){var c=o.children[l];de(c,this.options.draggable,o,!1)&&(r[i]=c)},this),n&&this.captureAnimationState(),e.forEach(function(i){r[i]&&(o.removeChild(r[i]),o.appendChild(r[i]))}),n&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,n){return de(e,n||this.options.draggable,this.el,!1)},option:function(e,n){var r=this.options;if(n===void 0)return r[e];var o=Ze.modifyOption(this,e,n);typeof o<"u"?r[e]=o:r[e]=n,e==="group"&&on(r)},destroy:function(){Q("destroy",this);var e=this.el;e[J]=null,T(e,"mousedown",this._onTapStart),T(e,"touchstart",this._onTapStart),T(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(T(e,"dragover",this),T(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),ct.splice(ct.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!De){if(Q("hideClone",this),g.eventCanceled)return;v(k,"display","none"),this.options.removeCloneOnHide&&k.parentNode&&k.parentNode.removeChild(k),De=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(De){if(Q("showClone",this),g.eventCanceled)return;f.parentNode==F&&!this.options.group.revertClone?F.insertBefore(k,f):Ne?F.insertBefore(k,Ne):F.appendChild(k),this.options.group.revertClone&&this.animate(f,k),v(k,"display",""),De=!1}}};function Rn(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function tt(t,e,n,r,o,i,l,c){var d,u=t[J],m=u.options.onMove,h;return window.CustomEvent&&!Ce&&!Ve?d=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(d=document.createEvent("Event"),d.initEvent("move",!0,!0)),d.to=e,d.from=t,d.dragged=n,d.draggedRect=r,d.related=o||e,d.relatedRect=i||X(e),d.willInsertAfter=c,d.originalEvent=l,t.dispatchEvent(d),m&&(h=m.call(u,d,l)),h}function wt(t){t.draggable=!1}function Hn(){Dt=!1}function Yn(t,e,n){var r=X(Ye(n.el,0,n.options,!0)),o=tn(n.el,n.options,E),i=10;return e?t.clientX<o.left-i||t.clientY<r.top&&t.clientX<r.right:t.clientY<o.top-i||t.clientY<r.bottom&&t.clientX<r.left}function Wn(t,e,n){var r=X(At(n.el,n.options.draggable)),o=tn(n.el,n.options,E),i=10;return e?t.clientX>o.right+i||t.clientY>r.bottom&&t.clientX>r.left:t.clientY>o.bottom+i||t.clientX>r.right&&t.clientY>r.top}function Xn(t,e,n,r,o,i,l,c){var d=r?t.clientY:t.clientX,u=r?n.height:n.width,m=r?n.top:n.left,h=r?n.bottom:n.right,D=!1;if(!l){if(c&&ot<u*o){if(!qe&&(Ue===1?d>m+u*i/2:d<h-u*i/2)&&(qe=!0),qe)D=!0;else if(Ue===1?d<m+ot:d>h-ot)return-Ue}else if(d>m+u*(1-o)/2&&d<h-u*(1-o)/2)return jn(e)}return D=D||l,D&&(d<m+u*i/2||d>h-u*i/2)?d>m+u/2?1:-1:0}function jn(t){return re(f)<re(t)?1:-1}function Gn(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,r=0;n--;)r+=e.charCodeAt(n);return r.toString(36)}function zn(t){dt.length=0;for(var e=t.getElementsByTagName("input"),n=e.length;n--;){var r=e[n];r.checked&&dt.push(r)}}function at(t){return setTimeout(t,0)}function _t(t){return clearTimeout(t)}ft&&x(document,"touchmove",function(t){(g.active||ke)&&t.cancelable&&t.preventDefault()});g.utils={on:x,off:T,css:v,find:Kt,is:function(e,n){return!!de(e,n,e,!1)},extend:Tn,throttle:Qt,closest:de,toggleClass:ee,clone:en,index:re,nextTick:at,cancelNextTick:_t,detectDirection:rn,getChild:Ye,expando:J};g.get=function(t){return t[J]};g.mount=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e[0].constructor===Array&&(e=e[0]),e.forEach(function(r){if(!r.prototype||!r.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(r));r.utils&&(g.utils=pe(pe({},g.utils),r.utils)),Ze.mount(r)})};g.create=function(t,e){return new g(t,e)};g.version=_n;var W=[],Xe,Mt,Tt=!1,Et,Ct,ut,je;function $n(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return t.prototype={dragStarted:function(n){var r=n.originalEvent;this.sortable.nativeDraggable?x(document,"dragover",this._handleAutoScroll):this.options.supportPointer?x(document,"pointermove",this._handleFallbackAutoScroll):r.touches?x(document,"touchmove",this._handleFallbackAutoScroll):x(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(n){var r=n.originalEvent;!this.options.dragOverBubble&&!r.rootEl&&this._handleAutoScroll(r)},drop:function(){this.sortable.nativeDraggable?T(document,"dragover",this._handleAutoScroll):(T(document,"pointermove",this._handleFallbackAutoScroll),T(document,"touchmove",this._handleFallbackAutoScroll),T(document,"mousemove",this._handleFallbackAutoScroll)),Ut(),it(),In()},nulling:function(){ut=Mt=Xe=Tt=je=Et=Ct=null,W.length=0},_handleFallbackAutoScroll:function(n){this._handleAutoScroll(n,!0)},_handleAutoScroll:function(n,r){var o=this,i=(n.touches?n.touches[0]:n).clientX,l=(n.touches?n.touches[0]:n).clientY,c=document.elementFromPoint(i,l);if(ut=n,r||this.options.forceAutoScrollFallback||Ve||Ce||Ge){St(n,this.options,c,r);var d=_e(c,!0);Tt&&(!je||i!==Et||l!==Ct)&&(je&&Ut(),je=setInterval(function(){var u=_e(document.elementFromPoint(i,l),!0);u!==d&&(d=u,it()),St(n,o.options,u,r)},10),Et=i,Ct=l)}else{if(!this.options.bubbleScroll||_e(c,!0)===me()){it();return}St(n,this.options,_e(c,!1),!1)}}},Ee(t,{pluginName:"scroll",initializeByDefault:!0})}function it(){W.forEach(function(t){clearInterval(t.pid)}),W=[]}function Ut(){clearInterval(je)}var St=Qt(function(t,e,n,r){if(e.scroll){var o=(t.touches?t.touches[0]:t).clientX,i=(t.touches?t.touches[0]:t).clientY,l=e.scrollSensitivity,c=e.scrollSpeed,d=me(),u=!1,m;Mt!==n&&(Mt=n,it(),Xe=e.scroll,m=e.scrollFn,Xe===!0&&(Xe=_e(n,!0)));var h=0,D=Xe;do{var N=D,I=X(N),P=I.top,A=I.bottom,oe=I.left,j=I.right,U=I.width,q=I.height,ge=void 0,ne=void 0,ve=N.scrollWidth,Me=N.scrollHeight,V=v(N),Te=N.scrollLeft,ue=N.scrollTop;N===d?(ge=U<ve&&(V.overflowX==="auto"||V.overflowX==="scroll"||V.overflowX==="visible"),ne=q<Me&&(V.overflowY==="auto"||V.overflowY==="scroll"||V.overflowY==="visible")):(ge=U<ve&&(V.overflowX==="auto"||V.overflowX==="scroll"),ne=q<Me&&(V.overflowY==="auto"||V.overflowY==="scroll"));var Ie=ge&&(Math.abs(j-o)<=l&&Te+U<ve)-(Math.abs(oe-o)<=l&&!!Te),ae=ne&&(Math.abs(A-i)<=l&&ue+q<Me)-(Math.abs(P-i)<=l&&!!ue);if(!W[h])for(var fe=0;fe<=h;fe++)W[fe]||(W[fe]={});(W[h].vx!=Ie||W[h].vy!=ae||W[h].el!==N)&&(W[h].el=N,W[h].vx=Ie,W[h].vy=ae,clearInterval(W[h].pid),(Ie!=0||ae!=0)&&(u=!0,W[h].pid=setInterval((function(){r&&this.layer===0&&g.active._onTouchMove(ut);var be=W[this.layer].vy?W[this.layer].vy*c:0,ie=W[this.layer].vx?W[this.layer].vx*c:0;typeof m=="function"&&m.call(g.dragged.parentNode[J],ie,be,t,ut,W[this.layer].el)!=="continue"||Jt(W[this.layer].el,ie,be)}).bind({layer:h}),24))),h++}while(e.bubbleScroll&&D!==d&&(D=_e(D,!1)));Tt=u}},30),sn=function(e){var n=e.originalEvent,r=e.putSortable,o=e.dragEl,i=e.activeSortable,l=e.dispatchSortableEvent,c=e.hideGhostForTarget,d=e.unhideGhostForTarget;if(n){var u=r||i;c();var m=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:n,h=document.elementFromPoint(m.clientX,m.clientY);d(),u&&!u.el.contains(h)&&(l("spill"),this.onSpill({dragEl:o,putSortable:r}))}};function Pt(){}Pt.prototype={startIndex:null,dragStart:function(e){var n=e.oldDraggableIndex;this.startIndex=n},onSpill:function(e){var n=e.dragEl,r=e.putSortable;this.sortable.captureAnimationState(),r&&r.captureAnimationState();var o=Ye(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(n,o):this.sortable.el.appendChild(n),this.sortable.animateAll(),r&&r.animateAll()},drop:sn};Ee(Pt,{pluginName:"revertOnSpill"});function Nt(){}Nt.prototype={onSpill:function(e){var n=e.dragEl,r=e.putSortable,o=r||this.sortable;o.captureAnimationState(),n.parentNode&&n.parentNode.removeChild(n),o.animateAll()},drop:sn};Ee(Nt,{pluginName:"removeOnSpill"});g.mount(new $n);g.mount(Nt,Pt);let It,cn;const Un=(t,e)=>{const n=t.item,r=parseInt(n.dataset.id,10);if(n.querySelector(".confirm-overlay"))return;n.classList.add("is-being-placed");const o=n.querySelector(".card-content");o&&o.classList.add("card-blur");const i=document.createElement("div");i.className="confirm-overlay";const l=document.createElement("button");l.textContent="Confirmar",l.className="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg",i.appendChild(l),n.appendChild(i),l.addEventListener("click",c=>{c.stopPropagation();const u=Array.from(b.timeline.children).indexOf(n);o&&o.classList.remove("card-blur"),i.remove(),n.classList.remove("is-being-placed"),e.onConfirmPlacement(r,u)},{once:!0})},qn=t=>{It=new g(b.timeline,{group:{name:"timeline-game",pull:!1,put:!0},sort:!0,animation:150,ghostClass:"card-ghost",delay:150,delayOnTouchOnly:!0,onAdd:e=>Un(e,t),onEnd:e=>{e.clone&&e.clone.parentNode&&e.clone.parentNode.removeChild(e.clone),["sortable-ghost","sortable-chosen","sortable-drag","sortable-fallback"].forEach(r=>{document.querySelectorAll(`.${r}`).forEach(i=>{i.parentNode&&i.parentNode.removeChild(i)})})}}),cn=new g(b.nextCardContainer,{group:{name:"timeline-game",pull:!0,put:!1},animation:150,ghostClass:"card-ghost",delay:150,delayOnTouchOnly:!0})},Vn=t=>{It&&(It.option("disabled",!t),cn.option("disabled",!t))},Zn=()=>{let t={};return{init:o=>{t=o,b.startButton.addEventListener("click",()=>t.onStartGame()),b.restartButton.addEventListener("click",()=>t.onStartGame()),b.playAgainButton.addEventListener("click",()=>{b.resultsModal.classList.add("hidden"),t.onStartGame()}),b.closeResultsModalButton.addEventListener("click",()=>{b.resultsModal.classList.add("hidden"),b.startScreen.classList.remove("hidden")}),b.timeline.addEventListener("click",i=>{const l=i.target.closest(".card-in-timeline");if(l&&b.timeline.classList.contains("very-dense-view")){const c=parseInt(l.dataset.id,10);t.onToggleCardExpansion&&t.onToggleCardExpansion(c)}}),qn(t)},update:o=>{En(o),Vn(!o.isGameOver)},showResumeGameModal:(o,i)=>{b.resumeModal.classList.remove("hidden"),b.mainContainer.classList.add("container-blur"),b.resumeYesButton.onclick=()=>{o(),b.resumeModal.classList.add("hidden"),b.mainContainer.classList.remove("container-blur")},b.resumeNoButton.onclick=()=>{i(),b.resumeModal.classList.add("hidden"),b.mainContainer.classList.remove("container-blur")}}}};export{Zn as createUIManager};
