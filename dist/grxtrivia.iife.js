(function(){"use strict";const v=document.getElementById("start-screen"),C=document.getElementById("game-screen"),k=document.getElementById("end-screen"),N=document.getElementById("start-button"),Y=document.getElementById("restart-button"),$=document.getElementById("score"),G=document.getElementById("card-counter"),m=document.getElementById("next-card-container"),o=document.getElementById("timeline");document.getElementById("final-score"),document.getElementById("correct-answers"),document.getElementById("wrong-answers");const L=document.getElementById("resume-modal"),H=document.getElementById("resume-yes-button"),O=document.getElementById("resume-no-button"),E=document.getElementById("results-modal"),D=document.getElementById("final-score-modal"),P=document.getElementById("correct-answers-modal"),R=document.getElementById("wrong-answers-modal"),j=document.getElementById("close-results-modal"),J=document.getElementById("play-again-button"),I="triviaGameState";let b=[],c=[],i=0,u=0,y=0,d=0,l=0,f,h;async function K(){try{const e=await fetch("events.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);b=await e.json()}catch(e){console.error("No se pudieron cargar los eventos:",e)}}function _(e){document.readyState==="interactive"||document.readyState==="complete"?e():document.addEventListener("DOMContentLoaded",e,{once:!0})}function z(){const e=Array.from(o.children).map(n=>({id:parseInt(n.dataset.id,10),isCorrect:n.classList.contains("correct"),isIncorrect:n.classList.contains("incorrect")})),t={score:i,correctAnswers:u,wrongAnswers:y,currentCardIndex:d,gameEvents:c,placedCards:e,streak:l};localStorage.setItem(I,JSON.stringify(t))}function w(){localStorage.removeItem(I)}function F(e){i=e.score,u=e.correctAnswers,y=e.wrongAnswers,d=e.currentCardIndex,c=e.gameEvents,l=e.streak||0,o.innerHTML="",e.placedCards.forEach(t=>{const n=b.find(r=>r.id===t.id);if(n){const r=t.isCorrect||t.isIncorrect?{correct:t.isCorrect}:null;T(n,r)}}),B(),M(0),A(),S(),v.classList.add("hidden"),k.classList.add("hidden"),C.classList.remove("hidden")}function Q(){w();const e=new Map;b.forEach(s=>{e.has(s.year)||e.set(s.year,[]),e.get(s.year).push(s)}),c=Array.from(e.keys()).sort(()=>.5-Math.random()).slice(0,11).map(s=>{const a=e.get(s);return a[Math.floor(Math.random()*a.length)]})}function x(){Q(),i=0,u=0,y=0,d=0,l=0,o.innerHTML="",m.innerHTML="",f.option("disabled",!1),h.option("disabled",!1);const e=Math.floor(Math.random()*c.length),t=c.splice(e,1)[0];M(0),A(),T(t,null,!0),B(),S(),v.classList.add("hidden"),k.classList.add("hidden"),C.classList.remove("hidden")}function U(){w(),D.textContent=i,P.textContent=u,R.textContent=y,E.classList.remove("hidden"),C.classList.add("hidden"),o.classList.remove("dense-view","very-dense-view"),Array.from(o.children).forEach(e=>{const t=e.querySelector(".card-content");if(t){t.classList.remove("card-blur"),t.querySelector("p").style.display="block";const n=t.querySelector("img");n&&(n.style.display="block")}}),j.onclick=()=>{E.classList.add("hidden"),v.classList.remove("hidden")},J.onclick=()=>{E.classList.add("hidden"),x()}}function V(){f=new Sortable(o,{group:{name:"timeline-game",pull:!1,put:!0},sort:!0,filter:".correct, .incorrect, .anchor-card",animation:150,ghostClass:"card-ghost",onAdd:W}),h=new Sortable(m,{group:{name:"timeline-game",pull:!0,put:!1},animation:150,ghostClass:"card-ghost"})}function W(e){const t=e.item;t.classList.add("card-in-timeline");const n=t.querySelector(".card-content");if(t.querySelector(".confirm-overlay"))return;n&&n.classList.add("card-blur");const r=document.createElement("div");r.className="confirm-overlay",r.style.backgroundColor="rgba(255, 255, 255, 0.5)";const s=document.createElement("button");s.textContent="Confirmar",s.className="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg",r.appendChild(s),t.appendChild(r),s.addEventListener("click",a=>{a.stopPropagation();const p=Array.from(o.children).indexOf(t);X(t,p)},{once:!0})}function B(){const e=o.children.length;o.classList.remove("dense-view","very-dense-view"),e>=8?o.classList.add("very-dense-view"):e>=5&&o.classList.add("dense-view")}function X(e,t){e.querySelector(".confirm-overlay").remove();const n=e.querySelector(".card-content");n&&n.classList.remove("card-blur"),f.option("disabled",!0),h.option("disabled",!0);const r=o.querySelector(".anchor-card");r&&r.classList.remove("anchor-card");const s=parseInt(e.dataset.year,10),a=Array.from(o.children),g=a[t-1],p=a[t+1],ee=g?parseInt(g.dataset.year,10):-1/0,te=p?parseInt(p.dataset.year,10):1/0,ne=s>ee&&s<te;if(e.querySelector(".year-badge").classList.remove("hidden"),ne){l++;const re=1+l;e.classList.add("correct"),M(re),u++}else l=0,e.classList.add("incorrect"),y++;B(),d++,d>=c.length?setTimeout(U,1200):(z(),A(),S(),f.option("disabled",!1),h.option("disabled",!1))}function q(e,t){const n=document.createElement("div");n.dataset.id=e.id,n.dataset.year=e.year,n.className="card bg-white p-4 rounded-lg shadow-lg w-full max-w-md mx-auto relative",n.classList.toggle("cursor-move",t);let r="";return e.image&&(r=`<img src="${e.image}" alt="${e.title}" class="w-full h-32 object-cover my-2 rounded">`),n.innerHTML=`
        <div class="card-content">
            <h3 class="font-bold text-lg text-gray-900">${e.title}</h3>
            <p class="text-gray-700 text-sm">${e.description}</p>
            ${r}
            <div class="year-badge hidden absolute top-2 right-2 bg-gray-200 text-xs font-bold px-2 py-1 rounded text-gray-800">${e.isApproximate?"Circa":""} ${e.year}</div>
        </div>
    `,n}function T(e,t,n=!1){const r=q(e,!1);r.classList.add("card-in-timeline"),n?(r.classList.add("anchor-card"),r.querySelector(".year-badge").classList.remove("hidden")):t&&(r.querySelector(".year-badge").classList.remove("hidden"),r.classList.add(t.correct?"correct":"incorrect"));const s=[...o.children],a=s.findIndex(g=>parseInt(g.dataset.year,10)>e.year);a===-1?o.appendChild(r):o.insertBefore(r,s[a])}function S(){if(d<c.length){const e=c[d],t=q(e,!0);m.innerHTML="",m.appendChild(t)}else m.innerHTML='<div class="text-center text-gray-500">¡No hay más cartas!</div>'}function M(e){e!==0&&(i+=e),$.textContent=i}function A(){G.textContent=`${d+1}/${c.length}`}_(()=>{K().then(()=>{V();const e=localStorage.getItem(I);e&&Z(JSON.parse(e)),N.addEventListener("click",x),Y.addEventListener("click",x)})});function Z(e){L.classList.remove("hidden"),H.onclick=()=>{F(e),L.classList.add("hidden")},O.onclick=()=>{w(),L.classList.add("hidden")}}})();
